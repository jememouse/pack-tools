<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>条码 / 二维码生成器｜包装工具箱</title>
    <meta name="description" content="快速生成 Code 39 条码与二维码，支持下载 SVG 或复制链接，方便包装设计稿标注。">
    <style>
        :root {
            color-scheme: light;
            --blue-600: #2563eb;
            --blue-500: #3b82f6;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-700: #334155;
            --slate-600: #475569;
            --slate-500: #64748b;
            --surface: rgba(255, 255, 255, 0.94);
        }

        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            margin: 0;
            font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif;
            background: linear-gradient(180deg, #eef2ff 0%, #e0f2fe 40%, #f8fafc 100%);
            color: var(--slate-700);
        }

        .skip-link {
            position: absolute;
            top: 0;
            left: 0;
            transform: translateY(-120%);
            background: var(--blue-600);
            color: #fff;
            padding: 0.6rem 1.2rem;
            border-radius: 0 0 1rem 1rem;
            transition: transform 0.2s ease;
            z-index: 1000;
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
        }
        .skip-link:focus { transform: translateY(0); outline: none; }

        .page-header {
            position: sticky;
            top: 0;
            z-index: 200;
            backdrop-filter: blur(18px);
            background: rgba(255, 255, 255, 0.92);
            border-bottom: 1px solid rgba(148, 163, 184, 0.28);
        }
        .page-header__inner {
            max-width: 74rem;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }
        .brand {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--slate-700);
            font-weight: 600;
            font-size: 1.05rem;
            text-decoration: none;
        }
        .brand svg { width: 2rem; height: 2rem; color: var(--blue-600); }

        .nav-links { display: flex; flex-wrap: wrap; align-items: center; gap: 0.6rem; }
        .nav-link {
            color: var(--slate-600);
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.45rem 0.85rem;
            border-radius: 0.85rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        .nav-link:hover { color: var(--blue-600); background: rgba(37, 99, 235, 0.14); }
        .nav-link[aria-current="page"] {
            color: var(--blue-600);
            background: rgba(37, 99, 235, 0.22);
            font-weight: 600;
            box-shadow: 0 12px 22px rgba(37, 99, 235, 0.18);
        }

        .cta-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 0.9rem;
            background: var(--blue-600);
            color: #fff;
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.55rem 1.15rem;
            text-decoration: none;
            box-shadow: 0 18px 35px rgba(37, 99, 235, 0.25);
            transition: background 0.2s ease, box-shadow 0.2s ease;
        }
        .cta-link:hover { background: #1d4ed8; box-shadow: 0 22px 40px rgba(37, 99, 235, 0.28); }

        .page-main {
            max-width: 74rem;
            margin: 0 auto;
            padding: 3.5rem 1.5rem 5rem;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
        }

        .page-hero {
            position: relative;
            overflow: hidden;
            border-radius: 1.8rem;
            padding: 3rem;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.92) 0%, rgba(59, 130, 246, 0.82) 45%, rgba(96, 165, 250, 0.78) 100%);
            color: #ecfeff;
            box-shadow: 0 35px 70px rgba(37, 99, 235, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .page-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 18% 20%, rgba(255, 255, 255, 0.25), transparent 55%),
                radial-gradient(circle at 80% 12%, rgba(255, 255, 255, 0.18), transparent 50%),
                linear-gradient(120deg, rgba(255, 255, 255, 0.08), transparent 60%);
            opacity: 0.92;
            pointer-events: none;
        }
        .page-hero__content { position: relative; z-index: 1; max-width: 54rem; }
        .page-hero__eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            font-size: 0.75rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.18);
            color: #dbeafe;
            border-radius: 999px;
            padding: 0.45rem 1.1rem;
            font-weight: 600;
            margin-bottom: 1.6rem;
        }
        .page-hero__title { margin: 0; font-size: 2.5rem; line-height: 1.18; font-weight: 700; }
        .page-hero__subtitle { margin-top: 1.5rem; font-size: 1.05rem; line-height: 1.75; color: rgba(236, 254, 255, 0.9); }

        .layout {
            display: grid;
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .layout { grid-template-columns: minmax(0, 1.35fr) minmax(0, 1fr); }
        }

        .panel {
            border-radius: 1.6rem;
            border: 1px solid rgba(148, 163, 184, 0.25);
            background: var(--surface);
            padding: 2.4rem;
            box-shadow: 0 28px 45px rgba(15, 23, 42, 0.08);
        }
        .panel h2 { margin: 0; font-size: 1.6rem; font-weight: 600; color: var(--slate-900); }
        .panel p.lead { margin-top: 0.8rem; font-size: 1rem; color: var(--slate-600); line-height: 1.6; }

        .form-grid { display: grid; gap: 1.4rem; }
        @media (min-width: 640px) { .form-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
        .form-grid label span { display: block; font-size: 0.9rem; color: var(--slate-600); margin-bottom: 0.4rem; }
        .form-grid input[type='text'],
        .form-grid textarea,
        .form-grid select {
            width: 100%;
            border-radius: 0.9rem;
            border: 1px solid rgba(148, 163, 184, 0.5);
            padding: 0.7rem 0.9rem;
            font-size: 0.95rem;
            line-height: 1.4;
            color: var(--slate-800);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            resize: vertical;
        }
        .form-grid textarea { min-height: 120px; }
        .form-grid input:focus,
        .form-grid textarea:focus,
        .form-grid select:focus {
            outline: none;
            border-color: var(--blue-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.22);
        }

        .form-actions { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }
        .form-actions button {
            border-radius: 9999px;
            border: none;
            background: var(--blue-600);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.6rem 1.4rem;
            cursor: pointer;
            transition: background 0.2s ease, box-shadow 0.2s ease;
        }
        .form-actions button:hover { background: #1d4ed8; box-shadow: 0 16px 28px rgba(37, 99, 235, 0.24); }

        .preview-card {
            border-radius: 1.4rem;
            border: 1px solid rgba(59, 130, 246, 0.22);
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            box-shadow: 0 24px 42px rgba(30, 64, 175, 0.12);
            display: flex;
            flex-direction: column;
            gap: 1.4rem;
        }
        .preview-surface {
            min-height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(248, 250, 252, 0.85);
            border-radius: 1rem;
            border: 1px dashed rgba(148, 163, 184, 0.4);
            padding: 1.5rem;
        }
        .preview-surface svg,
        .preview-surface img {
            max-width: 100%;
            height: auto;
        }
        .preview-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
        }
        .preview-actions button,
        .preview-actions a {
            border-radius: 0.85rem;
            padding: 0.55rem 1rem;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .preview-actions button.primary,
        .preview-actions a.primary {
            background: var(--blue-600);
            color: #fff;
        }
        .preview-actions button.secondary,
        .preview-actions a.secondary {
            background: rgba(37, 99, 235, 0.12);
            color: var(--blue-600);
        }

        .hint {
            font-size: 0.85rem;
            color: var(--slate-500);
            line-height: 1.5;
        }

        footer {
            background: rgba(15, 23, 42, 0.92);
            color: rgba(226, 232, 240, 0.88);
            text-align: center;
            padding: 2.5rem 1rem;
            font-size: 0.9rem;
        }
        footer a { color: #bfdbfe; text-decoration: none; }
        footer a:hover { text-decoration: underline; }

        @media (max-width: 640px) {
            .page-header__inner { flex-direction: column; align-items: flex-start; }
            .page-hero { padding: 2.4rem; }
            .page-hero__title { font-size: 2.15rem; }
            .page-hero__subtitle { font-size: 0.95rem; }
            .panel { padding: 2rem; }
            .preview-card { padding: 1.6rem; }
        }
    </style>
</head>
<body>
    <a class="skip-link" href="#main-content">跳到主要内容</a>

    <header class="page-header">
        <div class="page-header__inner">
            <a href="index.html" class="brand">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                </svg>
                <span>包装工具箱</span>
            </a>
            <nav class="nav-links" aria-label="主导航">
                <a class="nav-link" href="index.html#toolbox">工具箱</a>
                <a class="nav-link" href="index.html#resources">资源库</a>
                <a class="nav-link" href="index.html#suppliers">供应商名录</a>
                <a class="nav-link" href="barcode.html" aria-current="page">条码 / 二维码</a>
            </nav>
            <a href="mailto:contact@packaging-toolbox.site" class="cta-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12a4.5 4.5 0 00-9 0 11.38 11.38 0 01-.401 3.004c-.102.327-.153.49-.145.564a.45.45 0 00.18.308C7.3 15.99 7.48 16 7.837 16h8.326c.357 0 .536-.01.703-.124a.45.45 0 00.18-.308c.008-.074-.043-.237-.145-.564A11.38 11.38 0 0116.5 12z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a1.5 1.5 0 001.5-1.5h-3a1.5 1.5 0 001.5 1.5z" />
                </svg>
                联系顾问
            </a>
        </div>
    </header>

    <main id="main-content" class="page-main">
        <section class="page-hero">
            <div class="page-hero__content">
                <span class="page-hero__eyebrow">信息标识生成</span>
                <h1 class="page-hero__title">快速生成条码与二维码，辅助包装打样与说明标注</h1>
                <p class="page-hero__subtitle">支持 Code 39 条码与在线二维码生成，提供 SVG 导出与复制功能，方便将编码用于包装版面、物流标签或内部追踪系统。</p>
            </div>
        </section>

        <section class="layout">
            <div class="panel">
                <h2>填写编码内容</h2>
                <p class="lead">条码内容建议使用数字、字母及常见符号；二维码支持中文与多行文本，生成后可下载或直接复用链接。</p>

                <form id="barcode-form" novalidate>
                    <div class="form-grid">
                        <label for="barcode-type">
                            <span>编码类型</span>
                            <select id="barcode-type" name="type">
                                <option value="code39">Code 39 条码</option>
                                <option value="qrcode">二维码</option>
                            </select>
                        </label>
                        <label for="barcode-text">
                            <span>编码内容</span>
                            <textarea id="barcode-text" name="text" placeholder="输入需要生成的内容" required>PKG-2025-SAMPLE</textarea>
                        </label>
                        <label for="barcode-height" data-code39-option>
                            <span>条码高度 (px)</span>
                            <input id="barcode-height" name="height" type="text" inputmode="numeric" value="72">
                        </label>
                        <label for="barcode-width" data-code39-option>
                            <span>条码窄条宽度 (px)</span>
                            <input id="barcode-width" name="width" type="text" inputmode="numeric" value="2">
                        </label>
                        <label for="barcode-ec-level" data-qrcode-option hidden>
                            <span>二维码容错等级</span>
                            <select id="barcode-ec-level" name="ecLevel">
                                <option value="L">L - 7% 容错</option>
                                <option value="M" selected>M - 15% 容错</option>
                                <option value="Q">Q - 25% 容错</option>
                                <option value="H">H - 30% 容错</option>
                            </select>
                        </label>
                        <label for="barcode-size" data-qrcode-option hidden>
                            <span>二维码尺寸 (px)</span>
                            <input id="barcode-size" name="qrSize" type="text" inputmode="numeric" value="280">
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit">生成编码</button>
                        <p class="hint" data-feedback>输入后自动更新，如二维码生成失败请尝试缩短内容或降低容错等级。</p>
                    </div>
                </form>
            </div>

            <div class="preview-card">
                <header>
                    <h2 style="margin:0;font-size:1.2rem;font-weight:600;color:var(--slate-800);">预览与导出</h2>
                    <p class="hint">SVG 下载适合导入 AI / CDR；二维码基于 quickchart.io 生成，可复制链接或图片。</p>
                </header>
                <div class="preview-surface" data-preview>
                    <p class="hint">生成后将在此显示编码预览。</p>
                </div>
                <div class="preview-actions">
                    <button type="button" class="primary" data-download-svg disabled>下载 SVG</button>
                    <button type="button" class="secondary" data-copy-svg disabled>复制 SVG</button>
                </div>
            </div>
        </section>

        <section class="panel" aria-label="使用建议">
            <h2>使用提示</h2>
            <ul class="hint" style="margin-top:1rem; line-height:1.7;">
                <li>Code 39 支持数字、英文字母与部分常用符号，生成前系统会自动校验。</li>
                <li>二维码由 quickchart.io 提供在线绘制服务，确保终端联网以获得高清图片。</li>
                <li>若需批量生成条码，可搭配 Excel 或脚本批量拼接链接后下载。</li>
            </ul>
        </section>
    </main>

    <footer>
        <p>© 2025 包装工具箱 · 条码 / 二维码生成器</p>
        <p style="margin-top:0.5rem;"><a href="mailto:contact@packaging-toolbox.site">联系顾问团队</a></p>
    </footer>

    <script>
(function(){
const CODE39_ALPHABET={"0":"nnnwwnwnn","1":"wnnwnnnnw","2":"nnwwnnnnw","3":"wnwwnnnnn","4":"nnnwwnnnw","5":"wnnwwnnnn","6":"nnwwwnnnn","7":"nnnwnnwnw","8":"wnnwnnwnn","9":"nnwwnnwnn",A:"wnnnnwnnw",B:"nnwnnwnnw",C:"wnwnnwnnn",D:"nnnnwwnnw",E:"wnnnwwnnn",F:"nnwnwwnnn",G:"nnnnnwwnw",H:"wnnnnwwnn",I:"nnwnnwwnn",J:"nnnnwwwnn",K:"wnnnnnnww",L:"nnwnnnnww",M:"wnwnnnnwn",N:"nnnnwnnww",O:"wnnnwnnwn",P:"nnwnwnnwn",Q:"nnnnnnwww",R:"wnnnnnwwn",S:"nnwnnnwwn",T:"nnnnwnwwn",U:"wwnnnnnnw",V:"nwwnnnnnw",W:"wwwnnnnnn",X:"nwnnwnnnw",Y:"wwnnwnnnn",Z:"nwwnwnnnn","-":"nwnnnnwnw",".":"wwnnnnwnn"," ":"nwwnnnwnn","$":"nwnwnwnnn","/":"nwnwnnnwn","+":"nwnnnwnwn","%":"nnnwnwnwn","*":"nwnnwnwnn"};
const CODE39_ALLOWED=new Set(Object.keys(CODE39_ALPHABET));
function escapeXml(value){const map={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"};return value.replace(/[&<>"']/g,char=>map[char]);}
function generateCode39Svg(input,options={}){const{barHeight=72,narrowBarWidth=2,wideFactor=3,margin=12,includeText=true}=options;const trimmed=input.trim();if(!trimmed){throw new Error("请输入需要编码的内容。");}const upper=`*${trimmed.toUpperCase()}*`;for(const ch of upper){if(!CODE39_ALLOWED.has(ch)){throw new Error(`字符 "${ch}" 不受 Code 39 支持。`);}}const wideWidth=narrowBarWidth*Math.max(2,wideFactor);let totalWidth=margin*2;upper.split("").forEach(char=>{const pattern=CODE39_ALPHABET[char];for(let i=0;i<pattern.length;i+=1){totalWidth+=pattern[i]==="w"?wideWidth:narrowBarWidth;}totalWidth+=narrowBarWidth;});const viewHeight=includeText?barHeight+20:barHeight;const textY=barHeight+16;let currentX=margin;const bars=[];upper.split("").forEach((char,index)=>{const pattern=CODE39_ALPHABET[char];for(let i=0;i<pattern.length;i+=1){const isBar=i%2===0;const width=pattern[i]==="w"?wideWidth:narrowBarWidth;if(isBar){bars.push(`<rect x="${currentX}" y="0" width="${width}" height="${barHeight}" />`);}currentX+=width;}if(index!==upper.length-1){currentX+=narrowBarWidth;}});const svgParts=[];svgParts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="${viewHeight}" viewBox="0 0 ${totalWidth} ${viewHeight}" role="img" aria-label="Code 39 条码" preserveAspectRatio="xMidYMid meet">`);svgParts.push('<g fill="#111827">');svgParts.push(...bars);svgParts.push('</g>');if(includeText){const text=trimmed.toUpperCase();svgParts.push(`<text x="${totalWidth/2}" y="${textY}" text-anchor="middle" font-family="'Inter', 'Helvetica Neue', Arial, sans-serif" font-size="14" fill="#1f2937">${escapeXml(text)}</text>`);}svgParts.push('</svg>');return svgParts.join('');}

const EXP_TABLE=new Array(256);
const LOG_TABLE=new Array(256);
for(let i=0;i<8;i+=1){EXP_TABLE[i]=1<<i;}
for(let i=8;i<256;i+=1){EXP_TABLE[i]=EXP_TABLE[i-4]^EXP_TABLE[i-5]^EXP_TABLE[i-6]^EXP_TABLE[i-8];}
for(let i=0;i<255;i+=1){LOG_TABLE[EXP_TABLE[i]]=i;}
function gexp(n){return EXP_TABLE[(n%255+255)%255];}
function glog(n){if(n<1){throw new Error("glog("+n+")");}return LOG_TABLE[n];}
class QRPolynomial{constructor(num,shift){let offset=0;while(offset<num.length&&num[offset]===0){offset+=1;}this.num=new Array(num.length-offset+shift);for(let i=0;i<num.length-offset;i+=1){this.num[i]=num[i+offset];}for(let i=num.length-offset;i<this.num.length;i+=1){this.num[i]=0;}}get(index){return this.num[index];}getLength(){return this.num.length;}multiply(e){const num=new Array(this.getLength()+e.getLength()-1).fill(0);for(let i=0;i<this.getLength();i+=1){for(let j=0;j<e.getLength();j+=1){num[i+j]^=gexp(glog(this.get(i))+glog(e.get(j)));}}return new QRPolynomial(num,0);}mod(e){if(this.getLength()-e.getLength()<0){return this;}const ratio=glog(this.get(0))-glog(e.get(0));const num=this.num.slice();for(let i=0;i<e.getLength();i+=1){num[i]^=gexp(glog(e.get(i))+ratio);}return new QRPolynomial(num,0).mod(e);}static getErrorCorrectionPolynomial(errorCorrectLength){let poly=new QRPolynomial([1],0);for(let i=0;i<errorCorrectLength;i+=1){poly=poly.multiply(new QRPolynomial([1,gexp(i)],0));}return poly;}}
class QRBitBuffer{constructor(){this.buffer=[];this.length=0;}getLengthInBits(){return this.length;}put(num,length){for(let i=length-1;i>=0;i-=1){this.putBit(((num>>>i)&1)===1);}}putBit(bit){const bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0);}if(bit){this.buffer[bufIndex]|=128>>(this.length%8);}this.length+=1;}getBuffer(){return this.buffer;}}
const QRMode={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8};
const QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};
const ErrorCorrectLevel={L:1,M:0,Q:3,H:2};
const RS_BLOCK_TABLE=[
[1,26,19],[1,26,16],[1,26,13],[1,26,9],
[1,44,34],[1,44,28],[1,44,22],[1,44,16],
[1,70,55],[1,70,44],[2,35,17],[2,35,13],
[1,100,80],[2,50,32],[2,50,24],[4,25,9],
[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],
[2,86,68],[4,43,27],[4,43,19],[4,43,15],
[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],
[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],
[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],
[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],
[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],
[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],
[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],
[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],
[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],
[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],
[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],
[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],
[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],
[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16]
];
function getRSBlocks(typeNumber,errorCorrectionLevel){const rsBlock=RS_BLOCK_TABLE[(typeNumber-1)*4+errorCorrectionLevel];if(!rsBlock){throw new Error('bad rs block');}const list=[];let i=0;while(i<rsBlock.length){const count=rsBlock[i];const totalCount=rsBlock[i+1];const dataCount=rsBlock[i+2];i+=3;for(let j=0;j<count;j+=1){list.push({totalCount,dataCount});}}return list;}
const PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]];
function getPatternPosition(typeNumber){return PATTERN_POSITION_TABLE[typeNumber-1]??[];}
class QR8bitByte{constructor(data){this.mode=QRMode.MODE_8BIT_BYTE;this.data=data;}getLength(){return this.data.length;}write(buffer){for(let i=0;i<this.data.length;i+=1){buffer.put(this.data.charCodeAt(i),8);}}}
const BCH_POLY_INFO=0b10100110111;
const BCH_POLY_TYPE=0b1111100100101;
function getBCHTypeInfo(data){let d=data<<10;while(getBCHDigit(d)-getBCHDigit(BCH_POLY_INFO)>=0){d^=BCH_POLY_INFO<<(getBCHDigit(d)-getBCHDigit(BCH_POLY_INFO));}return data<<10|d;}
function getBCHTypeNumber(data){let d=data<<12;while(getBCHDigit(d)-getBCHDigit(BCH_POLY_TYPE)>=0){d^=BCH_POLY_TYPE<<(getBCHDigit(d)-getBCHDigit(BCH_POLY_TYPE));}return data<<12|d;}
function getBCHDigit(data){let digit=0;while(data!==0){digit+=1;data>>>=1;}return digit;}
function getMask(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2===0;case QRMaskPattern.PATTERN001:return i%2===0;case QRMaskPattern.PATTERN010:return j%3===0;case QRMaskPattern.PATTERN011:return(i+j)%3===0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2===0;case QRMaskPattern.PATTERN101:return(i*j)%2+(i*j)%3===0;case QRMaskPattern.PATTERN110:return((i*j)%2+(i*j)%3)%2===0;case QRMaskPattern.PATTERN111:return((i+j)%2+(i*j)%3)%2===0;default:return false;}}
function getBestMaskPattern(qr){let minPenalty=Infinity;let bestPattern=0;for(let i=0;i<8;i+=1){qr.makeImpl(true,i);const penalty=qr.calculatePenalty();if(penalty<minPenalty){minPenalty=penalty;bestPattern=i;}}return bestPattern;}
class QRCodeModel{constructor(typeNumber,errorCorrectionLevel){this.typeNumber=typeNumber;this.errorCorrectionLevel=errorCorrectionLevel;this.modules=[];this.moduleCount=0;this.dataCache=null;this.dataList=[];}addData(data){const newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;}isDark(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error('Invalid module coordinate');}return this.modules[row][col]===true;}getModuleCount(){return this.moduleCount;}make(){if(this.typeNumber<1){this.typeNumber=this.getMinimumTypeNumber();}this.makeImpl(false,getBestMaskPattern(this));}makeImpl(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount).fill(null).map(()=>new Array(this.moduleCount).fill(null));this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test);}if(this.dataCache==null){this.dataCache=this.createData();}this.mapData(this.dataCache,maskPattern);}createData(){const buffer=new QRBitBuffer();for(const data of this.dataList){buffer.put(data.mode,4);buffer.put(data.getLength(),QRCodeModel.getLengthInBits(data.mode,this.typeNumber));data.write(buffer);}const totalDataCount=this.getTotalDataCount();if(buffer.getLengthInBits()>totalDataCount*8){throw new Error('code length overflow.');}if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4);}while(buffer.getLengthInBits()%8!==0){buffer.putBit(false);}const paddingBytes=[0xec,0x11];let i=0;while(buffer.getLengthInBits()<totalDataCount*8){buffer.put(paddingBytes[i%2],8);i+=1;}return QRCodeModel.createBytes(buffer,this.typeNumber,this.errorCorrectionLevel);}setupTypeNumber(test){const bits=getBCHTypeNumber(this.typeNumber);for(let i=0;i<18;i+=1){const mod=((bits>>i)&1)===1;this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod;this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod;}}setupTypeInfo(test,maskPattern){const data=(this.errorCorrectionLevel<<3)|maskPattern;const bits=getBCHTypeInfo(data);for(let i=0;i<15;i+=1){const mod=((bits>>i)&1)===1;if(i<6){this.modules[i][8]=mod;}else if(i<8){this.modules[i+1][8]=mod;}else{this.modules[this.moduleCount-15+i][8]=mod;}if(i<8){this.modules[8][this.moduleCount-i-1]=mod;}else{this.modules[8][14-i]=mod;}}this.modules[this.moduleCount-8][8]=true;}mapData(data,maskPattern){let inc=-1;let row=this.moduleCount-1;let bitIndex=7;let byteIndex=0;for(let col=this.moduleCount-1;col>0;col-=2){if(col===6){col-=1;}for(;;){for(let c=0;c<2;c+=1){if(this.modules[row][col-c]===null){let dark=false;if(byteIndex<data.length){dark=((data[byteIndex]>>>bitIndex)&1)===1;}const mask=getMask(maskPattern,row,col-c);this.modules[row][col-c]=mask?!dark:dark;bitIndex-=1;if(bitIndex<0){byteIndex+=1;bitIndex=7;}}}row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break;}}}}getTotalDataCount(){const rsBlock=getRSBlocks(this.typeNumber,this.errorCorrectionLevel);return rsBlock.reduce((sum,block)=>sum+block.dataCount,0);}setupPositionProbePattern(row,col){for(let r=-1;r<=7;r+=1){if(row+r<=-1||this.moduleCount<=row+r){continue;}for(let c=-1;c<=7;c+=1){if(col+c<=-1||this.moduleCount<=col+c){continue;}if((0<=r&&r<=6&&(c===0||c===6))||(0<=c&&c<=6&&(r===0||r===6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}setupTimingPattern(){for(let r=8;r<this.moduleCount-8;r+=1){if(this.modules[r][6]!==null){continue;}this.modules[r][6]=r%2===0;}for(let c=8;c<this.moduleCount-8;c+=1){if(this.modules[6][c]!==null){continue;}this.modules[6][c]=c%2===0;}}setupPositionAdjustPattern(){const pos=getPatternPosition(this.typeNumber);for(let i=0;i<pos.length;i+=1){for(let j=0;j<pos.length;j+=1){const row=pos[i];const col=pos[j];if(this.modules[row]?.[col]!==null){continue;}for(let r=-2;r<=2;r+=1){for(let c=-2;c<=2;c+=1){this.modules[row+r][col+c]=Math.max(Math.abs(r),Math.abs(c))===2||(r===0&&c===0);}}}}}calculatePenalty(){let penalty=0;for(let row=0;row<this.moduleCount;row+=1){let sameCount=1;let prevDark=this.modules[row][0];for(let col=1;col<this.moduleCount;col+=1){const dark=this.modules[row][col];if(dark===prevDark){sameCount+=1;}else{if(sameCount>=5){penalty+=3+(sameCount-5);}prevDark=dark;sameCount=1;}}if(sameCount>=5){penalty+=3+(sameCount-5);}}for(let col=0;col<this.moduleCount;col+=1){let sameCount=1;let prevDark=this.modules[0][col];for(let row=1;row<this.moduleCount;row+=1){const dark=this.modules[row][col];if(dark===prevDark){sameCount+=1;}else{if(sameCount>=5){penalty+=3+(sameCount-5);}prevDark=dark;sameCount=1;}}if(sameCount>=5){penalty+=3+(sameCount-5);}}for(let row=0;row<this.moduleCount-1;row+=1){for(let col=0;col<this.moduleCount-1;col+=1){const count=(this.modules[row][col]?1:0)+(this.modules[row+1][col]?1:0)+(this.modules[row][col+1]?1:0)+(this.modules[row+1][col+1]?1:0);if(count===0||count===4){penalty+=3;}}}for(let row=0;row<this.moduleCount;row+=1){for(let col=0;col<this.moduleCount-10;col+=1){if(this.modules[row][col]&&!this.modules[row][col+1]&&this.modules[row][col+2]&&this.modules[row][col+3]&&this.modules[row][col+4]&&!this.modules[row][col+5]&&this.modules[row][col+6]&&!this.modules[row][col+7]&&!this.modules[row][col+8]&&!this.modules[row][col+9]&&!this.modules[row][col+10]){penalty+=40;}}}for(let col=0;col<this.moduleCount;col+=1){for(let row=0;row<this.moduleCount-10;row+=1){if(this.modules[row][col]&&!this.modules[row+1][col]&&this.modules[row+2][col]&&this.modules[row+3][col]&&this.modules[row+4][col]&&!this.modules[row+5][col]&&this.modules[row+6][col]&&!this.modules[row+7][col]&&!this.modules[row+8][col]&&!this.modules[row+9][col]&&!this.modules[row+10][col]){penalty+=40;}}}let darkCount=0;for(let row=0;row<this.moduleCount;row+=1){for(let col=0;col<this.moduleCount;col+=1){if(this.modules[row][col]){darkCount+=1;}}}const totalCount=this.moduleCount*this.moduleCount;const ratio=Math.abs(darkCount*100/totalCount-50)/5;penalty+=ratio*10;return penalty;}getMinimumTypeNumber(){for(let typeNumber=1;typeNumber<40;typeNumber+=1){const rsBlocks=getRSBlocks(typeNumber,this.errorCorrectionLevel);const totalDataCount=rsBlocks.reduce((sum,block)=>sum+block.dataCount,0);const buffer=QRCodeModel.createBuffer(this.dataList,typeNumber);if(buffer.getLengthInBits()<=totalDataCount*8){return typeNumber;}}throw new Error('Too long data');}static createBuffer(dataList,typeNumber){const buffer=new QRBitBuffer();for(const data of dataList){buffer.put(data.mode,4);buffer.put(data.getLength(),QRCodeModel.getLengthInBits(data.mode,typeNumber));data.write(buffer);}return buffer;}static getLengthInBits(mode,typeNumber){if(typeNumber>=1&&typeNumber<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:return 8;}}else if(typeNumber<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:return 16;}}else{switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:return 16;}}}static createBytes(buffer,typeNumber,errorCorrectionLevel){let offset=0;const rsBlocks=getRSBlocks(typeNumber,errorCorrectionLevel);const maxDcCount=Math.max(...rsBlocks.map(block=>block.dataCount));const maxEcCount=Math.max(...rsBlocks.map(block=>block.totalCount-block.dataCount));const totalCodeCount=rsBlocks.reduce((sum,block)=>sum+block.totalCount,0);const dcdata=rsBlocks.map(block=>new Array(block.dataCount).fill(0));const ecdata=rsBlocks.map(block=>new Array(block.totalCount-block.dataCount).fill(0));for(let r=0;r<rsBlocks.length;r+=1){const dcCount=rsBlocks[r].dataCount;for(let i=0;i<dcCount;i+=1){dcdata[r][i]=buffer.getBuffer()[offset+i]??0;}offset+=dcCount;const rsPoly=QRPolynomial.getErrorCorrectionPolynomial(ecdata[r].length);let rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);rawPoly=rawPoly.mod(rsPoly);for(let i=0;i<ecdata[r].length;i+=1){const modIndex=rawPoly.getLength()-ecdata[r].length+i;ecdata[r][i]=modIndex>=0?rawPoly.get(modIndex):0;}}const data=new Array(totalCodeCount);let index=0;for(let i=0;i<maxDcCount;i+=1){for(let r=0;r<rsBlocks.length;r+=1){if(i<dcdata[r].length){data[index]=dcdata[r][i];index+=1;}}}for(let i=0;i<maxEcCount;i+=1){for(let r=0;r<rsBlocks.length;r+=1){if(i<ecdata[r].length){data[index]=ecdata[r][i];index+=1;}}}return data;}}
class QRCode{constructor(typeNumber,errorCorrectionLevel){this.model=new QRCodeModel(typeNumber,errorCorrectionLevel);}addData(data){this.model.addData(data);}make(){this.model.make();}getModuleCount(){return this.model.getModuleCount();}isDark(row,col){return this.model.isDark(row,col);}}
function generateQrSvg(text,options={}){const content=text.trim();if(!content){throw new Error('请输入需要编码的内容。');}const errorCorrectionLevel=options.errorCorrectionLevel??'M';const baseSize=options.size??280;const margin=options.margin??4;const qr=new QRCode(-1,ErrorCorrectLevel[errorCorrectionLevel]);qr.addData(content);qr.make();const moduleCount=qr.getModuleCount();const moduleSize=Math.max(1,Math.floor(baseSize/(moduleCount+margin*2)));const renderedSize=moduleSize*(moduleCount+margin*2);const parts=[];parts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${renderedSize}" height="${renderedSize}" viewBox="0 0 ${renderedSize} ${renderedSize}" role="img" aria-label="二维码">`);parts.push('<rect width="100%" height="100%" fill="#ffffff"/>');parts.push('<g fill="#111827">');for(let row=0;row<moduleCount;row+=1){for(let col=0;col<moduleCount;col+=1){if(qr.isDark(row,col)){const x=(margin+col)*moduleSize;const y=(margin+row)*moduleSize;parts.push(`<rect x="${x}" y="${y}" width="${moduleSize}" height="${moduleSize}" />`);}}}parts.push('</g>');parts.push('</svg>');return parts.join('');}

document.addEventListener('DOMContentLoaded',()=>{
  const form=document.querySelector('#barcode-form');
  const typeSelect=document.querySelector('#barcode-type');
  const textInput=document.querySelector('#barcode-text');
  const heightInput=document.querySelector('#barcode-height');
  const widthInput=document.querySelector('#barcode-width');
  const ecSelect=document.querySelector('#barcode-ec-level');
  const sizeInput=document.querySelector('#barcode-size');
  const code39Options=document.querySelectorAll('[data-code39-option]');
  const qrOptions=document.querySelectorAll('[data-qrcode-option]');
  const preview=document.querySelector('[data-preview]');
  const downloadButton=document.querySelector('[data-download-svg]');
  const copyButton=document.querySelector('[data-copy-svg]');
  const feedback=document.querySelector('[data-feedback]');
  if(!form||!typeSelect||!textInput||!heightInput||!widthInput||!ecSelect||!sizeInput||!preview||!downloadButton||!copyButton||!feedback){return;}
  let currentSvg='';
  const setFeedback=(message,tone='default')=>{
    feedback.textContent=message;
    feedback.style.color=tone==='error'?'#dc2626':tone==='success'?'#047857':'var(--slate-500)';
  };
  const toNumber=(value,fallback)=>{const parsed=Number.parseFloat(value);return Number.isFinite(parsed)&&parsed>0?parsed:fallback;};
  const toggleOptions=()=>{const type=typeSelect.value;code39Options.forEach(el=>{el.hidden=type!=='code39';});qrOptions.forEach(el=>{el.hidden=type!=='qrcode';});};
  const renderCode39=()=>{
    try{
      const svg=generateCode39Svg(textInput.value,{barHeight:toNumber(heightInput.value,72),narrowBarWidth:toNumber(widthInput.value,2),includeText:true});
      preview.innerHTML='';
      preview.insertAdjacentHTML('afterbegin',svg);
      currentSvg=svg;
      downloadButton.disabled=false;
      copyButton.disabled=false;
      setFeedback('已生成 Code 39 条码，可下载或复制 SVG。','success');
    }catch(error){
      preview.innerHTML='<p class="hint">条码生成失败，请检查内容是否包含不支持的字符。</p>';
      currentSvg='';
      downloadButton.disabled=true;
      copyButton.disabled=true;
      setFeedback(error instanceof Error?error.message:'条码生成失败。','error');
    }
  };
  const renderQrCode=()=>{
    const text=textInput.value.trim();
    if(!text){
      preview.innerHTML='<p class="hint">请输入二维码内容。</p>';
      downloadButton.disabled=true;
      copyButton.disabled=true;
      setFeedback('请输入二维码内容。','error');
      currentSvg='';
      return;
    }
    const size=Math.min(Math.max(Math.floor(toNumber(sizeInput.value,280)),120),600);
    const ecLevel=ecSelect.value||'M';
    try{
      const svg=generateQrSvg(text,{errorCorrectionLevel:ecLevel,size,margin:4});
      preview.innerHTML='';
      preview.insertAdjacentHTML('afterbegin',svg);
      currentSvg=svg;
      downloadButton.disabled=false;
      copyButton.disabled=false;
      setFeedback('已生成二维码，可下载或复制 SVG。','success');
    }catch(error){
      preview.innerHTML='<p class="hint">二维码生成失败，请尝试简化内容或缩短长度。</p>';
      currentSvg='';
      downloadButton.disabled=true;
      copyButton.disabled=true;
      setFeedback(error instanceof Error?error.message:'二维码生成失败。','error');
    }
  };
  const render=()=>{const type=typeSelect.value;if(type==='code39'){renderCode39();}else{renderQrCode();}};
  typeSelect.addEventListener('change',()=>{toggleOptions();render();});
  form.addEventListener('input',()=>{render();});
  form.addEventListener('submit',event=>{event.preventDefault();render();});
  downloadButton.addEventListener('click',()=>{if(!currentSvg){return;}const blob=new Blob([currentSvg],{type:'image/svg+xml;charset=utf-8'});const url=URL.createObjectURL(blob);const anchor=document.createElement('a');anchor.href=url;anchor.download=`barcode-${Date.now()}.svg`;document.body.append(anchor);anchor.click();anchor.remove();URL.revokeObjectURL(url);setFeedback('已下载 SVG 文件。','success');});
  copyButton.addEventListener('click',async()=>{if(!currentSvg){return;}try{await navigator.clipboard.writeText(currentSvg);setFeedback('SVG 内容已复制，可直接粘贴到矢量软件中。','success');}catch(error){console.error('Failed to copy SVG',error);setFeedback('复制失败，请手动选择 SVG 文本。','error');}});
  toggleOptions();
  render();
});
})();
    </script>
</body>
</html>
